# Maintenance Run 0002

## Metadata
- **Date**: 2025-12-11
- **Base Commit**: abf667c (after run 0001 merge)
- **PR**: #96
- **Scope**: targeted (per architect feedback)

## Changes Since Last Run

```
abf667c Merge branch 'main' of github.com:cluesmith/codev
0d614b7 Merge pull request #95 from cluesmith/builder/maintain-k_5J
759b5e8 CLAUDE.md: emphasize parallel + background for 3-way reviews
97cdd97 MAINTAIN: add documentation pruning task (obsolete content, ~400 line limits)
787da2d MAINTAIN: clarify sources - arch.md from specs/plans, lessons-learned from reviews
de924b8 [Maintain] First maintenance run - update lessons-learned.md
```

**Summary**: Maintenance protocol improvements and run 0001 artifacts.

## Approach

Initial aggressive documentation pruning (85% reduction) was rejected by architect as too aggressive without sufficient explanation. Approach revised to targeted updates addressing specific PR comments.

## Tasks Completed

### Code Hygiene
- [x] Dead code removal - ts-prune run: `getBuildersByStatus`, `getUtil`, `TmuxSession` identified as unused. Kept as utility functions.
- [x] Unused dependencies - depcheck false positive (tsx/typescript used in build).
- [x] Dependency updates - **Fixed**: Upgraded vitest 2.1.9 → 4.0.15 to resolve 5 moderate esbuild/vite vulnerabilities.

### Documentation
- [x] **arch.md targeted updates** - Addressed specific PR comments (see below)
- [x] **CLAUDE.md update** - Added critical warning about keeping specs and plans separate
- [x] **AGENTS.md sync** - Synced with CLAUDE.md
- [x] lessons-learned.md - No new reviews to extract

### Framework
- [x] projectlist.md status - Verified current.

## Changes Made

### arch.md (targeted updates, +15 net lines)

**PR Comment: "what about git, gh, claude, gemini codex?"**
- Added "External Tools (Required)" section listing git, gh, and AI CLIs

**PR Comment: "What does built mean in this context?"**
- Added explanation that skeleton is copied during `npm run build`

**PR Comment: Obsolete references**
- Updated `proper-lockfile` → `better-sqlite3` (state management)
- Updated `Jest` → `Vitest` (testing framework)
- Removed hardcoded paths (`/Users/mwk/Development/ansari-project/codev/`)
- Updated `agent-farm/` → `packages/codev/` throughout
- Updated directory structure to reflect npm package layout
- Updated state file references: `state.json` → `state.db`, `ports.json` → `global.db`
- Removed `ports.lock` (SQLite WAL mode replaces file locking)

**PR Comment: "Emphasize this is for the af dashboard"**
- Updated template descriptions to specify "Agent Farm (`af`) dashboard"

**PR Comment: "Explain that these are skeletons for other projects"**
- Enhanced Key Distinction to explain codev-skeleton vs codev/ relationship

**Other fixes:**
- Updated alias recommendation → npm global install
- Removed obsolete JSON registry structure (now SQLite)

### CLAUDE.md / AGENTS.md (+6 lines each)

**PR Comment: "Emphasize DO NOT PUT PLANS in the SPEC file"**
- Added "CRITICAL: Keep Specs and Plans Separate" section with warning

### Dependencies
- vitest: 2.1.9 → 4.0.15 (breaking change, tests still pass)
- esbuild/vite vulnerabilities resolved

## Validation

- [x] Tests: 216/216 passing with vitest 4.x
- [x] Build: TypeScript compilation clean
- [x] Audit: 0 vulnerabilities

## Summary

Targeted maintenance run addressing architect feedback on PR #96:

| File | Change | Reason |
|------|--------|--------|
| arch.md | +15 lines net | Targeted fixes for outdated refs, added external tools |
| CLAUDE.md | +6 lines | Added spec/plan separation warning |
| AGENTS.md | +6 lines | Synced with CLAUDE.md |
| vitest | 2.1.9 → 4.0.15 | Security vulnerabilities |

Documentation files remain at original lengths. Aggressive pruning deferred to future run with clearer rationale.
