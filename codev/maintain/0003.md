# Maintenance Run 0003

## Metadata
- **Date**: 2025-12-11
- **Base Commit**: 7591ab9 (after run 0002 merge, PR #96)
- **PR**: #102
- **Scope**: full

## Changes Since Last Run

```
60cd8c5 Enhance arch.md guidance with dual-audience framing and consultation feedback
d73a2ee Fix all relative links in release notes
37f024e Fix image URL in release notes
31ab919 chore: bump version to 1.2.0
e6b6cc1 Add v1.2.0 Cordoba release notes
f426a5e Add v1.2.0 Cordoba release
b3a3eb6 Add context hierarchy diagram to cheatsheet and README
c4c2a01 Mark 0050 as integrated
5bad0b0 Update 0039 notes for TICK-005 (PR #88 merged)
81a4f95 Merge pull request #88 from cluesmith/builder/0039-codev-cli
656d183 [Spec 0039][TICK-005] Update documentation for codev import command
810b956 Mark 0052 as integrated
7cdcd09 Update 0052 status to committed (PR #99 merged)
b4007b0 Merge pull request #99 from cluesmith/builder/0052-agent-farm-internals-docs
... (47 commits total)
```

**Summary**: v1.2.0 Cordoba release, Spec 0039 TICK-005 (codev import), Spec 0050 (dashboard polish), Spec 0051 (cheatsheet), Spec 0052 (Agent Farm internals docs), MAINTAIN protocol improvements.

## Tasks Completed

### Code Hygiene
- [x] Dead code removal - ts-prune identified utility functions (`getBuildersByStatus`, `getUtil`, `TmuxSession`, etc.) which are kept as public API
- [x] Unused dependencies - depcheck: no issues
- [x] Dependency updates - npm audit: 0 vulnerabilities

### Documentation
- [x] arch.md sync - Updated "Last Updated" and version to reflect post-v1.2.0 state with Agent Farm internals
- [x] lessons-learned.md generation - Added 11 new lessons from reviews 0039-TICK-005, 0050, 0051, 0052
- [x] CLAUDE.md / AGENTS.md sync - Already in sync (no diff)
- [x] Documentation pruning - Reviewed CLAUDE.md (692 lines) and README.md (506 lines); above ~400 line guideline but content is essential reference material per protocol guidelines

### Framework
- [x] projectlist.md status updates - Updated project 0035 (MAINTAIN Protocol) from `implementing` to `committed` (PR #56 merged 2025-12-06)

## Findings

### ts-prune Results
Identified utility functions that appear unused but are intentionally kept:
- `getBuildersByStatus(status)` - public API for filtering builders
- `getUtil(id)` - public API for getting utility by ID
- `TmuxSession` - type export for API surface
- `escapeHtml` in projectlist-parser - used by tests
- Various projectlist-parser exports - used by tower server and tests

### Documentation Health
- CLAUDE.md (692 lines) and AGENTS.md are identical - in sync
- arch.md comprehensively updated by Spec 0052 - only version/date needed update
- lessons-learned.md extracted 11 new lessons from 4 new reviews

## Documentation Changes

### arch.md
| Section | Action | Reason |
|---------|--------|--------|
| Quick Start for Developers | NEW | Protocol requires onboarding guide |
| Quick Tracing Guide | NEW | Protocol requires debugging entry points |
| Glossary | NEW | Protocol requires domain term definitions |
| Invariants & Constraints | NEW | Protocol requires system constraints documentation |
| System-Wide Patterns | NEW | Protocol requires cross-cutting concerns (error handling, logging, config) |
| "Last Updated" footer | UPDATED | Date, version, and changes list updated |

**Note**: After adding new sections and running 3-way review, arch.md was optimized by replacing duplicated content with links:
- Git Commit Strategy → CLAUDE.md
- Development Patterns (sections 3 & 4) → CLAUDE.md
- File Naming Conventions → CLAUDE.md
- Troubleshooting → Quick Tracing Guide (internal link)
- Maintenance → MAINTAIN protocol
- Contributing → README.md
- Recent Infrastructure Changes → CHANGELOG.md

**Final size**: 1905 lines (from 2164 original), net reduction of 259 lines after adding required sections and removing duplicates.

### 3-Way Review Fixes
| Issue | Source | Fix |
|-------|--------|-----|
| Wrong paths in Quick Tracing Guide | Codex | Fixed `commands/start.ts` → `agent-farm/commands/start.ts` |
| Outdated port registry reference | Codex | Fixed `ports.json` → `global.db` |
| Wrong SQLite command syntax | Codex | Fixed to `sqlite3 -header -column` |
| Next Available Number wrong | Gemini | Fixed 0050 → 0053 in projectlist.md |
| Priority inconsistency | Gemini | Fixed 0051/0052 priority: high → medium |

### lessons-learned.md
| Section | Action | Reason |
|---------|--------|--------|
| Testing | ADDED 1 lesson | From 0039-TICK-005: regex character class design for user input |
| Architecture | ADDED 2 lessons | From 0039-TICK-005: CLI vs agents, AI-in-the-loop pattern |
| Documentation | ADDED 5 lessons | From 0051, 0052: tables, diagrams, security docs, error handling |
| UI/UX | NEW SECTION | From 0050: state change hooks, not-found vs empty, UX consistency |

### CLAUDE.md / README.md
| Section | Action | Reason |
|---------|--------|--------|
| All | KEPT | Content is essential reference material; size above guideline acceptable per protocol |

### projectlist.md
| Entry | Action | Reason |
|-------|--------|--------|
| 0035 MAINTAIN Protocol | status: implementing → committed | PR #56 merged 2025-12-06 |
| 0035 | committed_at timestamp added | Recorded merge timestamp |
| 0035 | notes updated | Added PR reference |

## Deferred

None - all maintenance tasks completed.

## Validation

- [x] Tests: 226/226 passing (vitest 4.0.15)
- [x] Build: TypeScript compilation clean
- [x] Audit: 0 vulnerabilities

## Summary

Maintenance run following v1.2.0 Cordoba release with significant arch.md improvements. Key accomplishments:

1. **arch.md restructure**: Added 5 new sections per MAINTAIN protocol requirements:
   - Quick Start for Developers (onboarding guide)
   - Quick Tracing Guide (debugging entry points)
   - Glossary (domain terms)
   - Invariants & Constraints (system rules)
   - System-Wide Patterns (error handling, logging, config)

2. **arch.md optimization**: Replaced duplicated content with links to canonical sources:
   - 7 sections replaced with links to CLAUDE.md, README.md, CHANGELOG.md, and internal sections
   - Net reduction: 259 lines (2164 → 1905 lines)

3. **3-way review fixes**: Addressed feedback from Gemini and Codex:
   - Fixed incorrect file paths in Quick Tracing Guide
   - Updated outdated `ports.json` → `global.db` references
   - Corrected SQLite command syntax
   - Fixed projectlist.md inconsistencies

4. **lessons-learned.md**: Added 11 new lessons from 4 reviews (0039-TICK-005, 0050, 0051, 0052)

5. **projectlist.md**: Fixed status for 0035 (MAINTAIN Protocol) from `implementing` to `committed`

6. **Verification**: CLAUDE.md/AGENTS.md in sync, tests (226/226), build clean, audit clean

No code hygiene issues requiring action. arch.md is now protocol-compliant and optimized.
