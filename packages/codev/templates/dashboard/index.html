<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Farm - {{PROJECT_NAME}}</title>
  <!-- CSS files loaded in dependency order -->
  <link rel="stylesheet" href="/dashboard/css/variables.css">
  <link rel="stylesheet" href="/dashboard/css/layout.css">
  <link rel="stylesheet" href="/dashboard/css/tabs.css">
  <link rel="stylesheet" href="/dashboard/css/statusbar.css">
  <link rel="stylesheet" href="/dashboard/css/dialogs.css">
  <link rel="stylesheet" href="/dashboard/css/activity.css">
  <link rel="stylesheet" href="/dashboard/css/projects.css">
  <link rel="stylesheet" href="/dashboard/css/files.css">
  <link rel="stylesheet" href="/dashboard/css/utilities.css">
</head>
<body>
  <header class="header">
    <h1>Agent Farm - {{PROJECT_NAME}}</h1>
    <div class="header-actions">
      <button class="btn activity-summary-btn" onclick="showActivitySummary()" title="What did I do today?">
        üïê Today
      </button>
    </div>
  </header>

  <main class="main">
    <!-- Left pane: Architect terminal -->
    <div class="left-pane">
      <div class="pane-header">
        <span class="status-dot" id="architect-status"></span>
        <span>Architect</span>
      </div>
      <div id="architect-content"></div>
    </div>

    <!-- Right pane: Tabbed interface -->
    <div class="right-pane">
      <div class="tab-bar">
        <div class="tabs-scroll" id="tabs-container"></div>
        <button class="overflow-btn" id="overflow-btn" onclick="toggleOverflowMenu()" aria-haspopup="true" aria-expanded="false" title="Show all tabs">
          <span>...</span>
          <span class="overflow-count" id="overflow-count">+0</span>
        </button>
        <div class="overflow-menu hidden" id="overflow-menu" role="menu"></div>
      </div>
      <div class="tab-content" id="tab-content"></div>
    </div>
  </main>

  <footer class="status-bar">
    <div class="status-item" id="status-architect">
      <span class="dot" style="background: var(--text-muted)"></span>
      <span>Architect: stopped</span>
    </div>
    <div class="status-item" id="status-builders">
      <span>0 builders</span>
    </div>
    <div class="status-item" id="status-shells">
      <span>0 shells</span>
    </div>
    <div class="status-item" id="status-files">
      <span>0 files</span>
    </div>
  </footer>

  <!-- File picker dialog -->
  <div class="dialog-overlay hidden" id="file-dialog">
    <div class="dialog">
      <h3>Open File</h3>
      <div class="quick-paths">
        <button class="quick-path" onclick="setFilePath('codev/specs/')">codev/specs/</button>
        <button class="quick-path" onclick="setFilePath('codev/plans/')">codev/plans/</button>
        <button class="quick-path" onclick="setFilePath('codev/reviews/')">codev/reviews/</button>
      </div>
      <input type="text" id="file-path-input" placeholder="Enter file path..." />
      <div class="dialog-actions">
        <button class="btn" onclick="hideFileDialog()">Cancel</button>
        <button class="btn" onclick="openFile()">Open</button>
      </div>
    </div>
  </div>

  <!-- Close confirmation dialog -->
  <div class="dialog-overlay hidden" id="close-dialog">
    <div class="dialog">
      <h3 id="close-dialog-title">Close tab?</h3>
      <p id="close-dialog-message" style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;"></p>
      <div class="dialog-actions">
        <button class="btn" onclick="hideCloseDialog()">Cancel</button>
        <button class="btn btn-danger" onclick="confirmClose()">Close</button>
      </div>
    </div>
  </div>

  <!-- Context menu -->
  <div class="context-menu hidden" id="context-menu" role="menu">
    <div class="context-menu-item" role="menuitem" tabindex="0" data-action="openContextTab" onclick="openContextTab()" onkeydown="handleContextMenuKeydown(event)">Open in New Tab</div>
    <div class="context-menu-item" role="menuitem" tabindex="-1" data-action="reloadContextTab" id="context-reload" onclick="reloadContextTab()" onkeydown="handleContextMenuKeydown(event)">Reload</div>
    <div class="context-menu-item" role="menuitem" tabindex="-1" data-action="closeActiveTab" onclick="closeActiveTab()" onkeydown="handleContextMenuKeydown(event)">Close</div>
    <div class="context-menu-item" role="menuitem" tabindex="-1" data-action="closeOtherTabs" onclick="closeOtherTabs()" onkeydown="handleContextMenuKeydown(event)">Close Others</div>
    <div class="context-menu-item danger" role="menuitem" tabindex="-1" data-action="closeAllTabs" onclick="closeAllTabs()" onkeydown="handleContextMenuKeydown(event)">Close All</div>
  </div>

  <!-- Toast container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Activity Summary Modal (Spec 0059) -->
  <div class="dialog-overlay hidden" id="activity-modal">
    <div class="dialog activity-dialog">
      <div class="activity-dialog-header">
        <h3>Today's Summary</h3>
        <button class="activity-close-btn" onclick="closeActivityModal()" title="Close (Esc)">√ó</button>
      </div>
      <div class="activity-dialog-content" id="activity-content">
        <div class="activity-loading">
          <span class="activity-spinner"></span>
          Loading activity...
        </div>
      </div>
      <div class="activity-dialog-footer">
        <button class="btn" onclick="copyActivitySummary()">üìã Copy to Clipboard</button>
        <button class="btn" onclick="closeActivityModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- File search palette (Cmd+P) - Spec 0058 -->
  <div id="file-palette" class="file-palette hidden">
    <div class="file-palette-backdrop" onclick="closePalette()"></div>
    <div class="file-palette-container">
      <input type="text"
             id="palette-input"
             class="file-palette-input"
             placeholder="Search files by name..."
             oninput="onPaletteInput(this.value)"
             onkeydown="onPaletteKeydown(event)" />
      <div id="palette-results" class="file-palette-results"></div>
    </div>
  </div>

  <!-- State injection (replaced by server) -->
  <script>
    // STATE_INJECTION_POINT
  </script>

  <!-- JavaScript files loaded in dependency order -->
  <script src="/dashboard/js/state.js"></script>
  <script src="/dashboard/js/utils.js"></script>
  <script src="/dashboard/js/tabs.js"></script>
  <script src="/dashboard/js/dialogs.js"></script>
  <script src="/dashboard/js/projects.js"></script>
  <script src="/dashboard/js/files.js"></script>
  <script src="/dashboard/js/activity.js"></script>
  <script src="/dashboard/js/main.js"></script>
</body>
</html>
